<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Persia's Rad Rides - AI Insurance Intake</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-pink-50 via-rose-50 to-red-50 h-screen flex flex-col">
  
  <!-- Header -->
  <div class="bg-gradient-to-r from-pink-600 via-rose-600 to-red-600 text-white px-6 py-4 shadow-lg relative overflow-hidden">
    <!-- Decorative pattern -->
    <div class="absolute inset-0 opacity-10">
      <div class="absolute top-0 right-0 text-9xl">üèéÔ∏è</div>
    </div>
    <div class="flex items-center gap-3 relative z-10">
      <div class="flex items-center gap-2">
        <span class="text-3xl">üèéÔ∏è</span>
        <div class="text-2xl font-bold">PERSIA'S RAD RIDES</div>
      </div>
      <div class="h-6 w-px bg-white opacity-50"></div>
      <div>
        <h1 class="text-xl font-bold">AI Insurance Intake</h1>
        <p class="text-sm opacity-90">Schema-Enforced Validation ‚Ä¢ Zero Cross-Contamination</p>
      </div>
    </div>
  </div>

  <!-- Progress Bar -->
  <div id="progress" class="bg-white border-b px-4 py-2 overflow-x-auto">
    <div class="flex items-center gap-1 justify-between min-w-max text-xs mx-auto">
      <div class="flex flex-col items-center">
        <div id="step1" class="w-8 h-8 rounded-full flex items-center justify-center font-bold bg-pink-600 text-white text-xs">1</div>
        <span class="text-xs mt-1">Name</span>
      </div>
      <div class="w-8 h-0.5 bg-gray-300" id="line1"></div>
      <div class="flex flex-col items-center">
        <div id="step2" class="w-8 h-8 rounded-full flex items-center justify-center font-bold bg-gray-300 text-gray-600 text-xs">2</div>
        <span class="text-xs mt-1">DOB</span>
      </div>
      <div class="w-8 h-0.5 bg-gray-300" id="line2"></div>
      <div class="flex flex-col items-center">
        <div id="step3" class="w-8 h-8 rounded-full flex items-center justify-center font-bold bg-gray-300 text-gray-600 text-xs">3</div>
        <span class="text-xs mt-1">Claim</span>
      </div>
      <div class="w-8 h-0.5 bg-gray-300" id="line3"></div>
      <div class="flex flex-col items-center">
        <div id="step4" class="w-8 h-8 rounded-full flex items-center justify-center font-bold bg-gray-300 text-gray-600 text-xs">4</div>
        <span class="text-xs mt-1">Method</span>
      </div>
      <div class="w-8 h-0.5 bg-gray-300" id="line4"></div>
      <div class="flex flex-col items-center">
        <div id="step5" class="w-8 h-8 rounded-full flex items-center justify-center font-bold bg-gray-300 text-gray-600 text-xs">5</div>
        <span class="text-xs mt-1">Carrier</span>
      </div>
      <div class="w-8 h-0.5 bg-gray-300" id="line5"></div>
      <div class="flex flex-col items-center">
        <div id="step6" class="w-8 h-8 rounded-full flex items-center justify-center font-bold bg-gray-300 text-gray-600 text-xs">6</div>
        <span class="text-xs mt-1">Policy</span>
      </div>
      <div class="w-8 h-0.5 bg-gray-300" id="line6"></div>
      <div class="flex flex-col items-center">
        <div id="step7" class="w-8 h-8 rounded-full flex items-center justify-center font-bold bg-gray-300 text-gray-600 text-xs">7</div>
        <span class="text-xs mt-1">Collision</span>
      </div>
      <div class="w-8 h-0.5 bg-gray-300" id="line7"></div>
      <div class="flex flex-col items-center">
        <div id="step8" class="w-8 h-8 rounded-full flex items-center justify-center font-bold bg-gray-300 text-gray-600 text-xs">8</div>
        <span class="text-xs mt-1">Comp</span>
      </div>
      <div class="w-8 h-0.5 bg-gray-300" id="line8"></div>
      <div class="flex flex-col items-center">
        <div id="step9" class="w-8 h-8 rounded-full flex items-center justify-center font-bold bg-gray-300 text-gray-600 text-xs">9</div>
        <span class="text-xs mt-1">VIN</span>
      </div>
    </div>
  </div>

  <!-- Chat Area -->
  <div id="chatArea" class="flex-1 overflow-y-auto px-6 py-4">
    <div id="messages" class="max-w-4xl mx-auto space-y-3">
      <div class="flex justify-start">
        <div class="bg-white border border-gray-200 rounded-lg px-4 py-3 max-w-xl">
          <p class="text-sm">Hi! I'll help collect your insurance info for your Persia's Rad Rides claim. Let's start with your full name as it appears on your insurance policy.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Input Area -->
  <div id="inputArea" class="bg-white border-t border-gray-300 px-6 py-4">
    <div class="max-w-4xl mx-auto">
      <div class="flex gap-3">
        <div class="flex-1 relative">
          <input 
            type="text" 
            id="userInput" 
            placeholder="Enter your full name..."
            class="w-full px-4 py-3 pr-24 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 text-base"
          />
          <button 
            id="toggleVisibility" 
            class="hidden absolute right-20 top-1/2 -translate-y-1/2 text-gray-600 hover:text-gray-800 px-2 py-1 text-xs font-medium"
          >
            Show
          </button>
          <div id="securityBadge" class="hidden absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1 bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-semibold">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            </svg>
            Secured
          </div>
        </div>
        <button 
          id="sendBtn"
          class="bg-pink-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-pink-700 shadow-md"
        >
          Send
        </button>
      </div>
      <p id="hint" class="text-sm text-gray-600 mt-2">üí° First and last name required</p>
    </div>
  </div>

  <!-- Dropdown Area (hidden initially) -->
  <div id="dropdownArea" class="hidden bg-white border-t border-gray-300 px-6 py-4">
    <div class="max-w-4xl mx-auto">
      <div class="flex gap-3">
        <select 
          id="dropdownSelect" 
          class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 text-base"
        >
        </select>
        <button 
          id="dropdownBtn"
          class="bg-pink-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-pink-700 shadow-md"
        >
          Continue
        </button>
      </div>
      <p id="dropdownHint" class="text-sm text-gray-600 mt-2"></p>
    </div>
  </div>

  <!-- Review Area (hidden initially) -->
  <div id="reviewArea" class="hidden bg-white border-t px-6 py-4 overflow-y-auto">
    <div class="max-w-4xl mx-auto">
      <div class="bg-white rounded-xl border-2 border-pink-300 p-6 shadow-lg">
        <h3 class="text-lg font-bold mb-4 text-gray-900">Review Your Information</h3>
        <p class="text-sm text-gray-600 mb-4">Please verify all information is accurate before submitting.</p>
        <div id="reviewData" class="space-y-2 mb-6 bg-gray-50 p-4 rounded-lg"></div>
        
        <!-- Verification Checkbox -->
        <div class="border-t border-gray-200 pt-4 mb-6">
          <label class="flex items-start gap-3 cursor-pointer">
            <input 
              type="checkbox" 
              id="verifyCheckbox"
              class="mt-1 w-5 h-5 text-pink-600 border-gray-300 rounded focus:ring-pink-500"
            />
            <span class="text-sm text-gray-700">
              <strong>I verify that all the information provided above is accurate and complete.</strong> I understand that providing false information may negatively affect the processing time of your claim.
            </span>
          </label>
        </div>

        <!-- Submit Button (disabled until checkbox) -->
        <button 
          id="submitBtn"
          disabled
          class="w-full bg-gray-400 text-white py-4 rounded-lg font-bold text-lg mb-4 cursor-not-allowed transition-all"
        >
          Submit Insurance Information
        </button>

        <p class="text-xs text-gray-500 text-center">By submitting, you agree to Persia's Rad Rides Terms of Service and Privacy Policy</p>
      </div>
    </div>
  </div>

  <!-- Confirmation Area (hidden initially) -->
  <div id="confirmationArea" class="hidden bg-white border-t px-6 py-4 overflow-y-auto">
    <div class="max-w-4xl mx-auto">
      <div class="bg-green-50 rounded-xl border-2 border-green-300 p-6 text-center">
        <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
        <h3 class="text-2xl font-bold text-green-800 mb-2">Submission Successful!</h3>
        <p class="text-gray-700 mb-6">Your insurance information has been securely received and validated.</p>
        
        <!-- Confirmation Number -->
        <div class="bg-white rounded-lg border-2 border-green-200 p-4 mb-6">
          <p class="text-sm text-gray-600 mb-1">Confirmation Number</p>
          <p id="confirmationNumber" class="text-3xl font-bold text-gray-900 tracking-wider font-mono"></p>
        </div>

        <!-- Delivery Options -->
        <div class="mb-6">
          <p class="text-sm font-semibold text-gray-700 mb-3">Send confirmation to:</p>
          <div class="flex gap-3 justify-center">
            <button 
              id="sendEmailBtn"
              class="flex-1 max-w-xs bg-pink-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-pink-700 transition flex items-center justify-center gap-2 shadow-md"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
              </svg>
              Email
            </button>
            <button 
              id="sendTextBtn"
              class="flex-1 max-w-xs bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition flex items-center justify-center gap-2"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
              </svg>
              Text
            </button>
          </div>
          <p id="deliveryConfirmation" class="text-sm text-gray-600 mt-3 hidden"></p>
        </div>

        <!-- Next Steps -->
        <div class="bg-blue-50 rounded-lg p-4 text-left">
          <p class="text-sm font-semibold text-gray-800 mb-2">Next Steps:</p>
          <ul class="text-sm text-gray-700 space-y-1">
            <li>‚Ä¢ Your claim will be processed within 24-48 hours</li>
            <li>‚Ä¢ You'll receive updates via email and SMS</li>
            <li>‚Ä¢ No cross-contamination detected - data securely stored</li>
            <li>‚Ä¢ Contact support if you have questions: support@persiasradrides.com</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="bg-gradient-to-r from-rose-800 to-red-900 text-white py-2">
    <p class="text-xs text-center">üîí Encrypted ‚Ä¢ ‚úì Real-time validation ‚Ä¢ ‚ö° Zero cross-contamination ‚Ä¢ üèéÔ∏è Persia's Rad Rides</p>
  </div>

  <script>
    const collectedData = {
      fullName: null,
      dateOfBirth: null,
      claimNumber: null,
      uploadChoice: null,
      carrier: null,
      policyNumber: null,
      hasCollision: null,
      collisionDeductible: null,
      hasComprehensive: null,
      comprehensiveDeductible: null,
      vinNumber: null
    };

    const fields = ['fullName', 'dateOfBirth', 'claimNumber', 'uploadChoice', 'carrier', 'policyNumber', 'hasCollision', 'collisionDeductible', 'hasComprehensive', 'comprehensiveDeductible', 'vinNumber'];
    let currentFieldIndex = 0;
    let skipDeductibles = { collision: false, comprehensive: false };

    const carriers = [
      'State Farm',
      'Geico',
      'Progressive',
      'Allstate',
      'USAA',
      'Liberty Mutual',
      'Farmers',
      'Nationwide',
      'Travelers',
      'American Family',
      'AAA',
      'Esurance',
      'Mercury',
      'The Hartford',
      'Safeco',
      'MetLife',
      'Erie Insurance',
      'Auto-Owners Insurance',
      'Other'
    ];

    const deductibles = ['$250', '$500', '$1000', '$1500', '$2000', '$2500'];

    const prompts = {
      fullName: 'full name',
      dateOfBirth: 'date of birth (MM/DD/YYYY)',
      uploadChoice: 'how you want to provide insurance information',
      carrier: 'insurance carrier',
      policyNumber: 'insurance policy number',
      hasCollision: 'whether you have collision coverage',
      collisionDeductible: 'collision deductible amount',
      hasComprehensive: 'whether you have comprehensive coverage',
      comprehensiveDeductible: 'comprehensive deductible amount',
      vinNumber: 'VIN (17 characters)',
      claimNumber: "Persia's Rad Rides claim number (6 digits only)"
    };

    const hints = {
      fullName: 'üí° First and last name required',
      dateOfBirth: 'üîí Secured field - Click "Show" to verify ‚Ä¢ Format: MM/DD/YYYY (e.g., 03/15/1985)',
      uploadChoice: 'üí° Type "manual" to enter manually OR "upload" to submit insurance card/declaration page',
      carrier: 'üí° Select your insurance company from the dropdown',
      policyNumber: 'üîí Secured field - Click "Show" to verify ‚Ä¢ Usually found on your insurance card',
      hasCollision: 'üí° Type "yes" or "no"',
      collisionDeductible: 'üí° Select your deductible amount',
      hasComprehensive: 'üí° Type "yes" or "no"',
      comprehensiveDeductible: 'üí° Select your deductible amount',
      vinNumber: 'üí° VIN is 17 characters (no I, O, Q, or 0)',
      claimNumber: "üí° Persia's Rad Rides claim number is exactly 6 digits (e.g., 123456)"
    };

    const labels = {
      fullName: 'Full Name',
      dateOfBirth: 'Date of Birth',
      uploadChoice: 'Data Entry Method',
      carrier: 'Insurance Carrier',
      policyNumber: 'Policy Number',
      hasCollision: 'Collision Coverage',
      collisionDeductible: 'Collision Deductible',
      hasComprehensive: 'Comprehensive Coverage',
      comprehensiveDeductible: 'Comprehensive Deductible',
      vinNumber: 'VIN',
      claimNumber: 'Claim Number'
    };

    function addMessage(text, isUser = false, isError = false) {
      const messagesDiv = document.getElementById('messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'}`;
      
      const bubble = document.createElement('div');
      bubble.className = `rounded-lg px-4 py-3 max-w-xl ${
        isUser ? 'bg-pink-600 text-white shadow-md' : 
        isError ? 'bg-red-100 border-2 border-red-300 text-red-900' : 
        'bg-white border border-gray-200 text-gray-900 shadow-sm'
      }`;
      bubble.innerHTML = `<p class="text-sm whitespace-pre-line">${text}</p>`;
      
      messageDiv.appendChild(bubble);
      messagesDiv.appendChild(messageDiv);
      
      setTimeout(() => {
        document.getElementById('chatArea').scrollTop = document.getElementById('chatArea').scrollHeight;
      }, 100);
    }

    function validateInput(field, value) {
      const trimmed = value.trim();
      
      switch(field) {
        case 'fullName':
          if (trimmed.split(' ').filter(s => s).length < 2) {
            return 'Please provide your full name (first and last name)';
          }
          break;
          
        case 'dateOfBirth':
          if (!/^(0[1-9]|1[0-2])\/(0[1-9]|[12][0-9]|3[01])\/\d{4}$/.test(trimmed)) {
            return 'Please use MM/DD/YYYY format (e.g., 03/15/1985)';
          }
          break;

        case 'uploadChoice':
          const choice = trimmed.toLowerCase();
          if (!['manual', 'upload'].includes(choice)) {
            return 'Please type "manual" or "upload"';
          }
          break;
          
        case 'policyNumber':
          if (trimmed.length < 6) {
            return 'Policy number seems too short. Please verify and re-enter';
          }
          break;

        case 'hasCollision':
        case 'hasComprehensive':
          const yesNo = trimmed.toLowerCase();
          if (!['yes', 'no'].includes(yesNo)) {
            return 'Please type "yes" or "no"';
          }
          break;
          
        case 'vinNumber':
          const vinCleaned = trimmed.replace(/\s/g, '').toUpperCase();
          if (vinCleaned.length !== 17) {
            return 'VIN must be exactly 17 characters';
          }
          if (vinCleaned.includes('0')) {
            return 'VIN contains the digit 0, which is not used in VINs. Please check and re-enter.';
          }
          if (vinCleaned.includes('I') || vinCleaned.includes('O') || vinCleaned.includes('Q')) {
            return 'VIN contains invalid letters (I, O, or Q are not used in VINs). Please check and re-enter.';
          }
          if (!/^[A-HJ-NPR-Z1-9]{17}$/.test(vinCleaned)) {
            return 'VIN contains invalid characters. Only letters A-H, J-N, P, R-Z and digits 1-9 are allowed.';
          }
          break;
          
        case 'claimNumber':
          if (!/^\d{6}$/.test(trimmed)) {
            return "Persia's Rad Rides claim number must be exactly 6 digits (numbers only)";
          }
          break;
      }
      
      return null;
    }

    function updateProgress(stepNum) {
      const step = document.getElementById(`step${stepNum}`);
      const line = document.getElementById(`line${stepNum}`);
      
      if (step) {
        step.className = 'w-8 h-8 rounded-full flex items-center justify-center font-bold bg-green-500 text-white text-xs';
        step.innerHTML = '‚úì';
      }
      if (line) line.className = 'w-8 h-0.5 bg-green-500';
      
      if (stepNum < 9) {
        const nextStep = document.getElementById(`step${stepNum + 1}`);
        if (nextStep) {
          nextStep.className = 'w-8 h-8 rounded-full flex items-center justify-center font-bold bg-pink-600 text-white text-xs';
        }
      }
    }

    function showDropdown(field) {
      document.getElementById('inputArea').classList.add('hidden');
      document.getElementById('dropdownArea').classList.remove('hidden');
      
      const select = document.getElementById('dropdownSelect');
      select.innerHTML = '';
      
      if (field === 'carrier') {
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = 'Select your insurance carrier...';
        defaultOption.disabled = true;
        defaultOption.selected = true;
        select.appendChild(defaultOption);
        
        carriers.forEach(carrier => {
          const option = document.createElement('option');
          option.value = carrier;
          option.textContent = carrier;
          select.appendChild(option);
        });
      } else if (field === 'collisionDeductible' || field === 'comprehensiveDeductible') {
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = 'Select deductible amount...';
        defaultOption.disabled = true;
        defaultOption.selected = true;
        select.appendChild(defaultOption);
        
        deductibles.forEach(ded => {
          const option = document.createElement('option');
          option.value = ded;
          option.textContent = ded;
          select.appendChild(option);
        });
      }
      
      document.getElementById('dropdownHint').textContent = hints[field];
    }

    function hideDropdown() {
      document.getElementById('dropdownArea').classList.add('hidden');
      document.getElementById('inputArea').classList.remove('hidden');
      
      // Check if current field needs password masking
      const currentField = fields[currentFieldIndex];
      const input = document.getElementById('userInput');
      if (currentField === 'dateOfBirth' || currentField === 'policyNumber') {
        input.type = 'password';
        document.getElementById('securityBadge').classList.remove('hidden');
        document.getElementById('toggleVisibility').classList.remove('hidden');
        document.getElementById('toggleVisibility').textContent = 'Show';
      } else {
        input.type = 'text';
        document.getElementById('securityBadge').classList.add('hidden');
        document.getElementById('toggleVisibility').classList.add('hidden');
      }
    }

    function showReview() {
      document.getElementById('inputArea').classList.add('hidden');
      document.getElementById('dropdownArea').classList.add('hidden');
      document.getElementById('reviewArea').classList.remove('hidden');
      
      const reviewDiv = document.getElementById('reviewData');
      reviewDiv.innerHTML = '';
      
      Object.keys(collectedData).forEach(key => {
        if (collectedData[key] !== null && collectedData[key] !== 'skipped') {
          const row = document.createElement('div');
          row.className = 'flex justify-between py-2 border-b border-gray-200';
          row.innerHTML = `
            <span class="text-sm font-medium text-gray-600">${labels[key]}:</span>
            <span class="text-sm font-bold text-gray-900">${collectedData[key]}</span>
          `;
          reviewDiv.appendChild(row);
        }
      });
    }

    function handleSend() {
      const input = document.getElementById('userInput');
      const value = input.value.trim();
      
      if (!value) return;
      
      const currentField = fields[currentFieldIndex];
      
      // Display masked value in chat for sensitive fields
      let displayValue = value;
      if (currentField === 'dateOfBirth' || currentField === 'policyNumber') {
        displayValue = '‚Ä¢'.repeat(value.length);
      }
      
      addMessage(displayValue, true);
      input.value = '';
      
      setTimeout(() => {
        // Handle upload choice special case
        if (currentField === 'uploadChoice' && value.toLowerCase() === 'upload') {
          collectedData[currentField] = 'Upload Documents';
          updateProgress(currentFieldIndex + 1);
          addMessage('‚úì Great! Please upload your insurance card and/or declaration page. For this demo, we\'ll continue with manual entry.');
          
          // Skip to VIN after upload choice
          currentFieldIndex = fields.indexOf('vinNumber');
          const nextField = fields[currentFieldIndex];
          addMessage(`Now, please provide your ${prompts[nextField]}.`);
          input.placeholder = `Enter your ${prompts[nextField]}...`;
          document.getElementById('hint').textContent = hints[nextField];
          
          // Update input type
          input.type = 'text';
          document.getElementById('securityBadge').classList.add('hidden');
          return;
        }

        const error = validateInput(currentField, value);
        
        if (error) {
          addMessage(`‚ùå ${error}\n\nPlease try again.`, false, true);
        } else {
          collectedData[currentField] = value;
          updateProgress(currentFieldIndex + 1);
          
          // Handle collision/comprehensive "no" responses
          if (currentField === 'hasCollision' && value.toLowerCase() === 'no') {
            skipDeductibles.collision = true;
            collectedData['collisionDeductible'] = 'N/A';
          }
          if (currentField === 'hasComprehensive' && value.toLowerCase() === 'no') {
            skipDeductibles.comprehensive = true;
            collectedData['comprehensiveDeductible'] = 'N/A';
          }

          currentFieldIndex++;
          
          // Skip deductible questions if coverage was "no"
          if (fields[currentFieldIndex] === 'collisionDeductible' && skipDeductibles.collision) {
            currentFieldIndex++;
          }
          if (fields[currentFieldIndex] === 'comprehensiveDeductible' && skipDeductibles.comprehensive) {
            currentFieldIndex++;
          }
          
          if (currentFieldIndex < fields.length) {
            const nextField = fields[currentFieldIndex];
            
            // Check if next field needs dropdown
            if (nextField === 'carrier' || nextField === 'collisionDeductible' || nextField === 'comprehensiveDeductible') {
              addMessage(`‚úì Perfect! Now, please select your ${prompts[nextField]}.`);
              showDropdown(nextField);
            } else {
              addMessage(`‚úì Perfect! Now, please provide your ${prompts[nextField]}.`);
              input.placeholder = `Enter your ${prompts[nextField]}...`;
              document.getElementById('hint').textContent = hints[nextField];
              
              // Set input type to password for sensitive fields
              if (nextField === 'dateOfBirth' || nextField === 'policyNumber') {
                input.type = 'password';
                document.getElementById('securityBadge').classList.remove('hidden');
                document.getElementById('toggleVisibility').classList.remove('hidden');
                document.getElementById('toggleVisibility').textContent = 'Show';
              } else {
                input.type = 'text';
                document.getElementById('securityBadge').classList.add('hidden');
                document.getElementById('toggleVisibility').classList.add('hidden');
              }
            }
          } else {
            addMessage('‚úì Excellent! All information collected. Please review below and submit when ready.');
            showReview();
          }
        }
      }, 400);
    }

    function handleDropdownContinue() {
      const select = document.getElementById('dropdownSelect');
      const value = select.value;
      
      if (!value) return;
      
      const currentField = fields[currentFieldIndex];
      
      addMessage(value, true);
      collectedData[currentField] = value;
      updateProgress(currentFieldIndex + 1);
      
      currentFieldIndex++;
      
      // Skip deductible questions if coverage was "no"
      if (fields[currentFieldIndex] === 'collisionDeductible' && skipDeductibles.collision) {
        currentFieldIndex++;
      }
      if (fields[currentFieldIndex] === 'comprehensiveDeductible' && skipDeductibles.comprehensive) {
        currentFieldIndex++;
      }
      
      setTimeout(() => {
        if (currentFieldIndex < fields.length) {
          const nextField = fields[currentFieldIndex];
          
          if (nextField === 'carrier' || nextField === 'collisionDeductible' || nextField === 'comprehensiveDeductible') {
            addMessage(`‚úì Perfect! Now, please select your ${prompts[nextField]}.`);
            showDropdown(nextField);
          } else {
            hideDropdown();
            addMessage(`‚úì Perfect! Now, please provide your ${prompts[nextField]}.`);
            const input = document.getElementById('userInput');
            input.placeholder = `Enter your ${prompts[nextField]}...`;
            document.getElementById('hint').textContent = hints[nextField];
          }
        } else {
          addMessage('‚úì Excellent! All information collected. Please review below and submit when ready.');
          showReview();
        }
      }, 400);
    }

    document.getElementById('sendBtn').addEventListener('click', handleSend);
    document.getElementById('userInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') handleSend();
    });

    document.getElementById('dropdownBtn').addEventListener('click', handleDropdownContinue);

    // Toggle password visibility
    document.getElementById('toggleVisibility').addEventListener('click', () => {
      const input = document.getElementById('userInput');
      const toggleBtn = document.getElementById('toggleVisibility');
      
      if (input.type === 'password') {
        input.type = 'text';
        toggleBtn.textContent = 'Hide';
      } else {
        input.type = 'password';
        toggleBtn.textContent = 'Show';
      }
    });

    // Enable submit button when checkbox is checked
    document.getElementById('verifyCheckbox').addEventListener('change', (e) => {
      const submitBtn = document.getElementById('submitBtn');
      if (e.target.checked) {
        submitBtn.disabled = false;
        submitBtn.className = 'w-full bg-red-600 text-white py-4 rounded-lg font-bold text-lg hover:bg-red-700 transition-all cursor-pointer shadow-lg';
      } else {
        submitBtn.disabled = true;
        submitBtn.className = 'w-full bg-gray-400 text-white py-4 rounded-lg font-bold text-lg cursor-not-allowed transition-all';
      }
    });

    // Handle submission
    document.getElementById('submitBtn').addEventListener('click', () => {
      if (!document.getElementById('verifyCheckbox').checked) return;
      
      // Generate confirmation number
      const confirmationNum = 'PRR-' + Math.floor(100000 + Math.random() * 900000);
      document.getElementById('confirmationNumber').textContent = confirmationNum;
      
      // Hide review, show confirmation
      document.getElementById('reviewArea').classList.add('hidden');
      document.getElementById('confirmationArea').classList.remove('hidden');
    });

    // Send via email
    document.getElementById('sendEmailBtn').addEventListener('click', () => {
      const confirmMsg = document.getElementById('deliveryConfirmation');
      confirmMsg.textContent = '‚úì Confirmation sent to your email';
      confirmMsg.classList.remove('hidden');
      confirmMsg.className = 'text-sm text-green-700 font-semibold mt-3';
      
      setTimeout(() => {
        confirmMsg.classList.add('hidden');
      }, 3000);
    });

    // Send via text
    document.getElementById('sendTextBtn').addEventListener('click', () => {
      const confirmMsg = document.getElementById('deliveryConfirmation');
      confirmMsg.textContent = '‚úì Confirmation sent via text message';
      confirmMsg.classList.remove('hidden');
      confirmMsg.className = 'text-sm text-green-700 font-semibold mt-3';
      
      setTimeout(() => {
        confirmMsg.classList.add('hidden');
      }, 3000);
    });
  </script>
</body>
</html>